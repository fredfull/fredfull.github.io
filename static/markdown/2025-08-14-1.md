# ffmpeg + tv.nrk.no

Last ned videoer fra nettspilleren til NRK:

1. Finn riktig url ved å starte en video og inspisere i nettelseren. Søk etter m3u8 under "Network" og finn playlist-fila:

![url til m3u8 ved inspeksjon i nettspilleren](/static/m3u8-nrk.png)

2. Bruk ffmpeg til å laste ned streamen og konvertere det til filformatet du vil.

```bash
ffmpeg -i "https://nrk-od2.telenorcdn.net/open/ps/nnfa/nnfa80000221/8bc2cc2e-2.smil/cmaf.m3u8" -c copy partilederdebatt-2021.mp4
```

3. Ferdig

## Mer

Innholdet i denne fila har url'er til video-, audio- og tekst-streamer.
Navnet på suffikset er et lite helvette å pakke ut, men det går noe som dette:

- M3 -> MP3 -> MPEG Audio Layer 3 -> Moving Pictures Experts Group Audio Layer 3
- U -> URL -> Uniform Resource Locator
- 8 -> UTF-8 -> 8-bit Unicode Transformation Format (i forskjel fra M3U som kan bruke ASCII som er 7 bit)

Første headeren i fila sier det er den utvida versjonen også, så vi ender opp med:

_Extended Moving Pictures Experts Group Audio Layer 3 Uniform Resource Locator 8-bit Unicode Transformation Format_

Innholdet i eksempelet over hadde dette innholdet:

```
#EXTM3U
#EXT-X-VERSION:6
#EXT-X-INDEPENDENT-SEGMENTS

# AUDIO groups
#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="aud1",LANGUAGE="un",NAME="Unknown",CHANNELS="2",AUTOSELECT=YES,DEFAULT=YES,URI="sc-gaFEQg/A0_index.m3u8"
#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="aud3",LANGUAGE="un",NAME="Unknown",CHANNELS="2",AUTOSELECT=YES,DEFAULT=YES,URI="sc-gaFEQg/A2_index.m3u8"
#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="aud4",LANGUAGE="un",NAME="Unknown",CHANNELS="2",AUTOSELECT=YES,DEFAULT=YES,URI="sc-gaFEQg/A3_index.m3u8"

# SUBTITLES groups
#EXT-X-MEDIA:TYPE=SUBTITLES,GROUP-ID="sub1",LANGUAGE="no",NAME="Norsk",AUTOSELECT=YES,DEFAULT=YES,URI="sc-gaFEQg/s0_index.m3u8"

# Variants
#EXT-X-STREAM-INF:BANDWIDTH=257736,AVERAGE-BANDWIDTH=209089,CODECS="avc1.42c00c,mp4a.40.2",RESOLUTION=320x180,FRAME-RATE=25.000,AUDIO="aud1",SUBTITLES="sub1"
sc-gaFEQg/V0_index.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=491020,AVERAGE-BANDWIDTH=383814,CODECS="avc1.42c015,mp4a.40.2",RESOLUTION=480x270,FRAME-RATE=25.000,AUDIO="aud1",SUBTITLES="sub1"
sc-gaFEQg/V1_index.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=878048,AVERAGE-BANDWIDTH=693486,CODECS="avc1.4d401e,mp4a.40.2",RESOLUTION=640x360,FRAME-RATE=25.000,AUDIO="aud3",SUBTITLES="sub1"
sc-gaFEQg/V2_index.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=1800092,AVERAGE-BANDWIDTH=1423390,CODECS="avc1.4d401f,mp4a.40.2",RESOLUTION=960x540,FRAME-RATE=25.000,AUDIO="aud4",SUBTITLES="sub1"
sc-gaFEQg/V3_index.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=3025969,AVERAGE-BANDWIDTH=2400139,CODECS="avc1.64001f,mp4a.40.2",RESOLUTION=1280x720,FRAME-RATE=25.000,AUDIO="aud4",SUBTITLES="sub1"
sc-gaFEQg/V4_index.m3u8
```

Uten å spesifisere hvilke streamer som skal brukes, så har ffmpeg gode ut-av-boksen innstillinger:

> Automatic stream selection
>
> In the absence of any map options for a particular output file, ffmpeg inspects the output format to check which type of
> streams can be included in it, viz. video, audio and/or subtitles. For each acceptable stream type, ffmpeg will pick one
> stream, when available, from among all the inputs.
>
> It will select that stream based upon the following criteria:
>
> - for video, it is the stream with the highest resolution,
> - for audio, it is the stream with the most channels (...)
>   [^1]

Og husk:

_NRK har enerett til å fremstille eksemplarer av sine nettsider, og til å gjøre nettsidene tilgjengelige for allmennheten. Nettsidene kan derfor ikke kopieres, reproduseres, republiseres, lastes ned eller på noen annen måte gjengis eller overføres, uten etter skriftlig forhåndsgodkjenning fra NRK._
**Unntak gjelder for bruk til privat, ikke-kommersiell bruk.** [^2]

[^1]: man ffmpeg

[^2]: <https://www.nrk.no/etikk/opphavsrett-pa-nrk.no-1.2843522>
